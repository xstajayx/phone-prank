<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
<title>System Alert</title>
<style>
  :root{
    --g:#00ff66;
    --r:#ff0033;
    --bg:#000;
    --muted: rgba(0,255,102,.65);
  }
  *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
  html,body{ height:100%; }
  body{
    margin:0;
    background:var(--bg);
    color:var(--g);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    overflow:hidden;
    user-select:none;
  }

  /* Best-effort "immersive" */
  body.fullscreen-ish{
    overscroll-behavior: none;
    touch-action: manipulation;
  }

  /* Screen flash */
  #flash{
    position:fixed; inset:0;
    background:#fff;
    opacity:0;
    pointer-events:none;
    z-index:99999;
    transition: opacity .06s linear;
  }

  /* Red alert overlay */
  #redalert{
    position:fixed; inset:0;
    background: radial-gradient(ellipse at center, rgba(255,0,51,.18), rgba(0,0,0,.88) 65%);
    opacity:0;
    pointer-events:none;
    z-index:90000;
    transition: opacity .2s ease;
  }

  /* Main wrap */
  #wrap{
    position:fixed; inset:0;
    padding: 14px 14px calc(14px + env(safe-area-inset-bottom));
    filter: saturate(1.06) contrast(1.10);
  }

  /* Top bar */
  .top{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    padding: 12px 12px;
    border:1px solid rgba(0,255,102,.22);
    border-radius: 16px;
    background: rgba(0,0,0,.48);
    box-shadow: 0 0 0 1px rgba(0,255,102,.06);
  }
  .badge{
    display:inline-flex; align-items:center; gap:10px;
    font-size: 12px;
    letter-spacing: .12em;
    color: rgba(255,0,51,.92);
    text-transform: uppercase;
  }
  .dot{
    width:10px; height:10px; border-radius:999px;
    background: var(--r);
    box-shadow: 0 0 12px rgba(255,0,51,.6);
    animation: blink 1s infinite;
  }
  @keyframes blink{ 50%{ opacity:.12; } }
  .hint{
    font-size: 12px;
    letter-spacing:.10em;
    color: rgba(0,255,102,.62);
    text-transform: uppercase;
  }

  .grid{
    margin-top: 12px;
    display:grid;
    grid-template-columns: 1fr;
    gap: 12px;
    height: calc(100% - 74px);
  }

  .panel{
    border:1px solid rgba(0,255,102,.22);
    border-radius: 18px;
    background: rgba(0,0,0,.48);
    padding: 12px;
    overflow:hidden;
    position: relative;
  }

  /* Scanlines + vignette */
  .panel::before{
    content:"";
    position:absolute; inset:0;
    background: repeating-linear-gradient(
      to bottom,
      rgba(0,255,102,.045),
      rgba(0,255,102,.045) 1px,
      rgba(0,0,0,.0) 3px,
      rgba(0,0,0,.0) 6px
    );
    mix-blend-mode: screen;
    pointer-events:none;
    opacity:.55;
  }
  .panel::after{
    content:"";
    position:absolute; inset:-20px;
    background: radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,.62) 85%);
    pointer-events:none;
  }

  .title{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
    position: relative;
    z-index: 1;
  }
  .title h2{
    margin:0;
    font-size: 13px;
    letter-spacing:.14em;
    text-transform: uppercase;
    color: rgba(0,255,102,.9);
  }
  .title .threat{
    font-size: 12px;
    letter-spacing: .1em;
    color: rgba(255,0,51,.92);
    text-transform: uppercase;
  }

  /* Log area */
  #log{
    height: 46vh;
    overflow:hidden;
    border-radius: 14px;
    border:1px solid rgba(0,255,102,.16);
    padding: 10px;
    background: rgba(0,0,0,.36);
    box-shadow: inset 0 0 0 1px rgba(0,255,102,.06);
    position: relative;
    z-index: 1;
  }
  .line{
    font-size: 13px;
    line-height: 1.35;
    color: rgba(0,255,102,.92);
    text-shadow: 0 0 12px rgba(0,255,102,.12);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .dim{ color: rgba(0,255,102,.62); }
  .warn{ color: rgba(255,0,51,.95); text-shadow: 0 0 14px rgba(255,0,51,.2); }
  .cyan{ color: rgba(0,200,255,.85); text-shadow: 0 0 14px rgba(0,200,255,.18); }

  /* Progress bars */
  .bars{
    margin-top: 10px;
    display:grid;
    gap: 10px;
    position: relative;
    z-index: 1;
  }
  .barrow{
    display:grid;
    grid-template-columns: auto 1fr auto;
    align-items:center;
    gap: 10px;
    font-size: 12px;
    color: rgba(0,255,102,.75);
    letter-spacing: .08em;
    text-transform: uppercase;
  }
  .track{
    height: 10px;
    border-radius: 999px;
    border:1px solid rgba(0,255,102,.22);
    overflow:hidden;
    background: rgba(0,0,0,.35);
  }
  .fill{
    height:100%;
    width:0%;
    background: linear-gradient(90deg, rgba(0,255,102,.78), rgba(0,255,102,.22));
    box-shadow: 0 0 20px rgba(0,255,102,.18);
    border-radius: 999px;
    transition: width .12s linear;
  }

  #footerWarn{
    margin-top: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    border:1px solid rgba(255,0,51,.35);
    color: rgba(255,0,51,.92);
    background: rgba(255,0,51,.08);
    letter-spacing: .12em;
    text-transform: uppercase;
    text-align:center;
    font-size: 12px;
    position: relative;
    z-index: 1;
  }

  /* Shake */
  .shake{ animation: shake .14s infinite; }
  @keyframes shake{
    0%{ transform: translate(0,0) rotate(0deg); }
    20%{ transform: translate(1px,-1px) rotate(-.2deg); }
    40%{ transform: translate(-1px,1px) rotate(.2deg); }
    60%{ transform: translate(2px,1px) rotate(-.2deg); }
    80%{ transform: translate(-2px,-1px) rotate(.2deg); }
    100%{ transform: translate(0,0) rotate(0deg); }
  }

  /* Fake popups */
  #popLayer{
    position:fixed; inset:0;
    pointer-events:none;
    z-index: 80000;
  }
  .pop{
    position:absolute;
    width: min(290px, 84vw);
    border-radius: 14px;
    border:1px solid rgba(0,255,102,.26);
    background: rgba(0,0,0,.78);
    box-shadow: 0 12px 50px rgba(0,0,0,.55), 0 0 0 1px rgba(0,255,102,.08);
    overflow:hidden;
    pointer-events:auto;
    transform: translateZ(0);
  }
  .pop .bar{
    display:flex; align-items:center; justify-content:space-between;
    gap:10px;
    padding: 10px 10px;
    border-bottom:1px solid rgba(0,255,102,.16);
    background: rgba(0,255,102,.08);
  }
  .pop .bar .t{
    font-size: 12px;
    letter-spacing:.10em;
    text-transform: uppercase;
    color: rgba(0,255,102,.9);
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .pop .bar .x{
    width: 30px; height: 26px;
    border-radius: 10px;
    border:1px solid rgba(255,0,51,.35);
    color: rgba(255,0,51,.95);
    background: rgba(255,0,51,.08);
    font-weight: 900;
    line-height: 1;
    cursor: pointer;
    display:flex; align-items:center; justify-content:center;
  }
  .pop .body{
    padding: 10px;
    font-size: 12px;
    color: rgba(0,255,102,.75);
    letter-spacing:.06em;
    line-height: 1.35;
  }
  .pop .body .bad{
    color: rgba(255,0,51,.95);
    font-weight: 800;
  }

  /* EPIC overlay */
  #epic{
    position:fixed; inset:0;
    display:flex; align-items:center; justify-content:center;
    background: radial-gradient(ellipse at center, rgba(255,0,51,.16), rgba(0,0,0,.92) 60%);
    opacity:0;
    pointer-events:none;
    z-index: 95000;
    transition: opacity .25s ease;
    text-align:center;
    padding: 18px;
  }
  #epic .stack{
    width:min(900px, 96vw);
    border-radius: 24px;
    border: 1px solid rgba(255,0,51,.38);
    background: rgba(0,0,0,.72);
    box-shadow: 0 0 0 1px rgba(255,0,51,.12), 0 30px 90px rgba(0,0,0,.65);
    padding: 18px 16px;
    position: relative;
    overflow: hidden;
  }
  #epic .big{
    font-size: clamp(22px, 6vw, 46px);
    letter-spacing: .14em;
    text-transform: uppercase;
    color: rgba(255,0,51,.95);
    text-shadow: 0 0 18px rgba(255,0,51,.22);
    margin: 0 0 10px;
  }
  #epic .sub{
    font-size: 13px;
    letter-spacing: .10em;
    color: rgba(0,255,102,.78);
    text-transform: uppercase;
    margin: 0 0 12px;
  }
  #epicFeed{
    margin: 10px auto 0;
    width: min(720px, 92vw);
    max-height: 22vh;
    overflow:hidden;
    border-radius: 16px;
    border:1px solid rgba(0,255,102,.18);
    background: rgba(0,0,0,.45);
    padding: 10px 10px;
    text-align:left;
  }
  .feedLine{
    font-size: 12px;
    letter-spacing: .08em;
    line-height: 1.45;
    text-transform: uppercase;
    color: rgba(0,255,102,.75);
    white-space: nowrap;
    overflow:hidden;
    text-overflow: ellipsis;
  }
  .feedWarn{ color: rgba(255,0,51,.95); font-weight: 900; }

  /* Fake cam preview */
  #camBox{
    margin: 12px auto 0;
    width: min(360px, 88vw);
    aspect-ratio: 4/3;
    border-radius: 18px;
    border: 1px solid rgba(0,255,102,.25);
    overflow:hidden;
    position: relative;
    background: rgba(0,0,0,.6);
    box-shadow: inset 0 0 0 1px rgba(0,255,102,.08);
  }
  #camCanvas{ width:100%; height:100%; display:block; }
  #camHud{
    position:absolute; inset:0;
    pointer-events:none;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    padding: 10px 10px;
  }
  .hudRow{
    display:flex; justify-content:space-between; align-items:center;
    font-size: 11px;
    letter-spacing: .12em;
    text-transform: uppercase;
    color: rgba(0,255,102,.75);
    text-shadow: 0 0 12px rgba(0,255,102,.16);
  }
  .rec{
    display:inline-flex; align-items:center; gap:8px;
    color: rgba(255,0,51,.95);
  }
  .recDot{
    width:8px; height:8px; border-radius:999px;
    background: rgba(255,0,51,.95);
    box-shadow: 0 0 10px rgba(255,0,51,.5);
    animation: blink .9s infinite;
  }

  /* Hint */
  #tapHint{
    position: fixed;
    left: 12px; right: 12px;
    bottom: calc(12px + env(safe-area-inset-bottom));
    padding: 10px 12px;
    border-radius: 14px;
    border:1px solid rgba(0,255,102,.20);
    background: rgba(0,0,0,.55);
    color: rgba(0,255,102,.66);
    font-size: 12px;
    letter-spacing: .12em;
    text-transform: uppercase;
    text-align:center;
    z-index: 1200;
    pointer-events:none;
    opacity: .88;
  }

  /* Final lock */
  #lock{
    position:fixed; inset:0;
    display:none;
    z-index: 999999;
    background: radial-gradient(ellipse at center, rgba(0,255,102,.06), rgba(0,0,0,.96) 60%);
    color: var(--g);
    padding: 18px;
  }
  #lock .card{
    width: min(520px, 94vw);
    margin: 0 auto;
    border-radius: 22px;
    border:1px solid rgba(0,255,102,.24);
    background: rgba(0,0,0,.72);
    box-shadow: 0 0 0 1px rgba(0,255,102,.08), 0 30px 90px rgba(0,0,0,.7);
    padding: 18px 16px;
    text-align:center;
    position: relative;
    top: 14vh;
  }
  #lock .h{
    font-size: 18px;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: rgba(255,0,51,.95);
    margin: 0 0 10px;
  }
  #lock .p{
    font-size: 12px;
    letter-spacing: .10em;
    line-height: 1.55;
    color: rgba(0,255,102,.74);
    text-transform: uppercase;
    margin: 0 0 14px;
  }
  #lock input{
    width: min(320px, 86vw);
    padding: 14px 14px;
    border-radius: 14px;
    border: 1px solid rgba(0,255,102,.22);
    background: rgba(0,0,0,.55);
    color: rgba(0,255,102,.9);
    letter-spacing: .18em;
    text-align:center;
    font-size: 14px;
    outline: none;
  }
  #lock .err{
    margin-top: 12px;
    font-size: 12px;
    letter-spacing: .14em;
    text-transform: uppercase;
    color: rgba(255,0,51,.92);
    opacity: 0;
    transition: opacity .2s ease;
  }
  #lock .code{
    margin-top: 12px;
    font-size: 12px;
    letter-spacing: .14em;
    color: rgba(0,255,102,.55);
    text-transform: uppercase;
  }

  /* Final Rick Roll stage */
  #final{
    position:fixed; inset:0;
    display:none;
    z-index: 999990;
    background: #000;
    color: #fff;
    padding: 16px;
  }
  #final .wrap{
    max-width: 900px;
    margin: 0 auto;
    text-align:center;
    padding-top: 10vh;
  }
  #final h1{
    margin:0 0 10px;
    font-size: 22px;
    letter-spacing:.12em;
    text-transform: uppercase;
    color: var(--g);
    font-family: inherit;
  }
  #final p{
    margin: 0 0 14px;
    opacity: .8;
    font-size: 13px;
    letter-spacing:.08em;
    text-transform: uppercase;
    font-family: inherit;
  }
  #final .btn{
    display:inline-block;
    margin-top: 10px;
    padding: 14px 16px;
    border-radius: 14px;
    border:1px solid rgba(0,255,102,.35);
    background: rgba(0,255,102,.10);
    color: var(--g);
    font-weight: 900;
    letter-spacing:.14em;
    text-transform: uppercase;
    cursor: pointer;
    font-family: inherit;
  }
  #final iframe{
    width: min(900px, 94vw);
    aspect-ratio: 16/9;
    border: 1px solid rgba(0,255,102,.25);
    border-radius: 14px;
    margin-top: 14px;
    background:#000;
  }
</style>
</head>
<body>

<div id="flash"></div>
<div id="redalert"></div>
<div id="popLayer"></div>

<div id="epic" aria-hidden="true">
  <div class="stack">
    <p class="big">SYSTEM BREACH COMPLETE</p>
    <p class="sub" id="epicSub">REMOTE OPERATOR: CONNECTED</p>

    <div id="camBox" aria-hidden="true">
      <canvas id="camCanvas"></canvas>
      <div id="camHud">
        <div class="hudRow">
          <span class="rec"><span class="recDot"></span> REC</span>
          <span id="camTime">00:00</span>
        </div>
        <div class="hudRow">
          <span id="gpsHud">GPS: ---.------, ---.------</span>
          <span>FRONT</span>
        </div>
      </div>
    </div>

    <div id="epicFeed" aria-label="breach feed"></div>
  </div>
</div>

<div id="wrap">
  <div class="top">
    <div class="badge"><span class="dot"></span> REMOTE SESSION ACTIVE</div>
    <div class="hint" id="hint">tap anywhere</div>
  </div>

  <div class="grid">
    <div class="panel" id="panel">
      <div class="title">
        <h2>Device Telemetry</h2>
        <div class="threat" id="threat">THREAT: SCANNING</div>
      </div>

      <div id="log"></div>

      <div class="bars">
        <div class="barrow">
          <span>ENCRYPT</span>
          <div class="track"><div class="fill" id="b1"></div></div>
          <span id="p1">0%</span>
        </div>
        <div class="barrow">
          <span>ACCESS</span>
          <div class="track"><div class="fill" id="b2"></div></div>
          <span id="p2">0%</span>
        </div>
        <div class="barrow">
          <span>UPLOAD</span>
          <div class="track"><div class="fill" id="b3"></div></div>
          <span id="p3">0%</span>
        </div>
      </div>

      <div id="footerWarn">DO NOT TURN OFF YOUR DEVICE</div>
    </div>
  </div>
</div>

<div id="tapHint">first tap unlocks fullscreen + sound (browser rule)</div>

<div id="lock" aria-hidden="true">
  <div class="card">
    <p class="h">DEVICE LOCKED</p>
    <p class="p">
      Remote security protocol enabled<br>
      Recovery key required to regain access
    </p>
    <input id="pinInput" inputmode="numeric" placeholder="ENTER RECOVERY KEY" maxlength="10" />
    <div class="err" id="pinErr">INVALID KEY ‚Äî ACCESS DENIED</div>
    <div class="code">ERROR CODE: 0xDEADFACE</div>
  </div>
</div>

<div id="final" aria-hidden="true">
  <div class="wrap">
    <h1>FINAL PAYLOAD DELIVERED</h1>
    <p>tap to review ‚Äúincident report‚Äù</p>
    <button class="btn" id="playBtn">PLAY REPORT</button>
    <div id="vidSlot"></div>
  </div>
</div>

<script>
  const $ = (id)=>document.getElementById(id);
  const logEl = $("log");
  const flashEl = $("flash");
  const redEl = $("redalert");
  const popLayer = $("popLayer");
  const panel = $("panel");
  const epic = $("epic");
  const epicFeed = $("epicFeed");
  const lock = $("lock");
  const final = $("final");

  // ---------- Feed + log (triple-visibility) ----------
  function addFeed(text, isWarn=false){
    const d = document.createElement("div");
    d.className = "feedLine" + (isWarn ? " feedWarn" : "");
    d.textContent = text;
    epicFeed.appendChild(d);
    while(epicFeed.childNodes.length > 9) epicFeed.removeChild(epicFeed.firstChild);
  }

  function addLine(text, cls=""){
    const d = document.createElement("div");
    d.className = "line " + cls;
    d.textContent = text;
    logEl.appendChild(d);
    while(logEl.childNodes.length > 26) logEl.removeChild(logEl.firstChild);

    // Mirror key events into the epic feed so it's impossible to miss
    const warn = cls.includes("warn");
    if(epic.style.opacity === "1") addFeed(text, warn);
  }

  // ---------- Visual helpers ----------
  function flash(times=2){
    let i=0;
    const go=()=>{
      flashEl.style.opacity="0.9";
      setTimeout(()=>flashEl.style.opacity="0", 65);
      i++;
      if(i<times) setTimeout(go, 120);
    };
    go();
  }
  function vibrate(pattern){
    try{ if(navigator.vibrate) navigator.vibrate(pattern); }catch(e){}
  }

  // ---------- WebAudio (after tap) ----------
  let audioCtx, masterGain;
  function initAudio(){
    if(audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.18;
    masterGain.connect(audioCtx.destination);
  }
  function beep(freq=880, dur=0.08, type="square", gain=0.12){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.value = freq;
    g.gain.value = 0.0001;
    o.connect(g); g.connect(masterGain);
    const t = audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(gain, t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
    o.start(t);
    o.stop(t+dur+0.02);
  }
  function startSiren(ms=2400){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = "sawtooth";
    g.gain.value = 0.0001;
    o.connect(g); g.connect(masterGain);
    o.start();
    const t0 = audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.16, t0 + 0.05);

    let up = true;
    const step = ()=>{
      const t = audioCtx.currentTime;
      const target = up ? 900 : 220;
      o.frequency.exponentialRampToValueAtTime(target, t + 0.22);
      up = !up;
    };
    step();
    const int = setInterval(step, 240);

    setTimeout(()=>{
      clearInterval(int);
      const t = audioCtx.currentTime;
      g.gain.exponentialRampToValueAtTime(0.0001, t+0.1);
      setTimeout(()=>{ try{o.stop();}catch(e){} }, 180);
    }, ms);
  }

  function glitchBurst(){
    panel.classList.add("shake");
    redEl.style.opacity="1";
    flash(3);
    vibrate([60,40,60,40,120]);
    beep(1200, 0.06, "square", 0.14);
    beep(240, 0.18, "sawtooth", 0.12);
    setTimeout(()=>panel.classList.remove("shake"), 700);
    setTimeout(()=>redEl.style.opacity="0", 900);
  }

  // ---------- Fake popups ----------
  const popTitles = [
    "SECURITY WARNING","KERNEL ALERT","REMOTE ACCESS","PERMISSION GRANT","DEVICE ADMIN",
    "DATA LOSS","ENCRYPTION ERROR","SYSTEM POLICY","FIREWALL","TOR EXIT NODE","PAYLOAD STAGE","SESSION HIJACK"
  ];
  function spawnPopup(customBody=null){
    const p = document.createElement("div");
    p.className = "pop";
    p.style.left = (8 + Math.random()*72) + "vw";
    p.style.top  = (10 + Math.random()*70) + "vh";
    p.style.transform = `translate(-50%,-50%) rotate(${(Math.random()*2-1)*1.2}deg)`;

    const title = popTitles[Math.floor(Math.random()*popTitles.length)];
    const body = customBody || [
      `Unauthorized session detected.<br><span class="bad">Action required</span>.`,
      `Device integrity compromised.<br><span class="bad">Privilege escalation</span>.`,
      `Proxy chain online.<br><span class="bad">Routing via TOR</span>.`,
      `Indexing media‚Ä¶<br><span class="bad">Sensitive flags raised</span>.`,
      `Exfil queue: ACTIVE.<br><span class="bad">Do not power off</span>.`
    ][Math.floor(Math.random()*5)];

    p.innerHTML = `
      <div class="bar">
        <div class="t">${title}</div>
        <div class="x" title="Close">X</div>
      </div>
      <div class="body">${body}</div>
    `;

    const x = p.querySelector(".x");
    x.addEventListener("pointerenter", ()=>{
      p.style.left = (8 + Math.random()*84) + "vw";
      p.style.top  = (10 + Math.random()*76) + "vh";
      if(Math.random() < 0.22) flash(1);
      if(Math.random() < 0.18) glitchBurst();
      if(Math.random() < 0.25 && popLayer.childNodes.length < 22) spawnPopup();
    });
    x.addEventListener("click", (e)=>{
      e.stopPropagation();
      addLine("‚ö† WINDOW CLOSE BLOCKED (POLICY)", "warn");
      flash(2);
      if(popLayer.childNodes.length < 26){ spawnPopup(); spawnPopup(); }
      if(Math.random() < 0.6) glitchBurst();
    });

    popLayer.appendChild(p);
  }
  function popupStorm(count=10, interval=140){
    let made = 0;
    const t = setInterval(()=>{
      spawnPopup();
      made++;
      if(Math.random() < 0.25) flash(1);
      if(made >= count) clearInterval(t);
    }, interval);
  }

  // ---------- Progress bars ----------
  function runBars(){
    const b1=$("b1"), b2=$("b2"), b3=$("b3");
    const p1=$("p1"), p2=$("p2"), p3=$("p3");
    let a=0, b=0, c=0;
    const tick=()=>{
      a = Math.min(100, a + (Math.random()*6));
      b = Math.min(100, b + (Math.random()*7));
      c = Math.min(100, c + (Math.random()*5));

      b1.style.width = a.toFixed(0)+"%"; p1.textContent = a.toFixed(0)+"%";
      b2.style.width = b.toFixed(0)+"%"; p2.textContent = b.toFixed(0)+"%";
      b3.style.width = c.toFixed(0)+"%"; p3.textContent = c.toFixed(0)+"%";

      if((a>80 && Math.random()<0.12) || (b>85 && Math.random()<0.12) || (c>75 && Math.random()<0.12)){
        panel.classList.add("shake");
        flash(1);
        beep(1400,0.05,"square",0.10);
        setTimeout(()=>panel.classList.remove("shake"), 140);
      }
      requestAnimationFrame(()=>{
        if(a<100 || b<100 || c<100) setTimeout(tick, 110);
      });
    };
    tick();
  }

  // ---------- Fake GPS ----------
  function randomCoord(){
    // UK-ish plausible range
    const lat = (51.0 + Math.random()*2.2).toFixed(6);
    const lon = (-0.6 - Math.random()*2.0).toFixed(6);
    return { lat, lon };
  }
  let gps = randomCoord();
  function updateGpsHud(){
    const el = $("gpsHud");
    if(el) el.textContent = `GPS: ${gps.lat}, ${gps.lon}`;
  }

  // ---------- Fake camera preview ----------
  let camCanvas, camCtx, camT = 0, camTimer = null;
  function startFakeCam(){
    camCanvas = $("camCanvas");
    if(!camCanvas) return;
    camCtx = camCanvas.getContext("2d", { alpha:false });

    const resize = ()=>{
      const box = camCanvas.parentElement.getBoundingClientRect();
      camCanvas.width = Math.floor(box.width);
      camCanvas.height = Math.floor(box.height);
    };
    resize();
    window.addEventListener("resize", resize);

    const start = performance.now();
    const draw = (now)=>{
      camT = (now - start)/1000;
      const w = camCanvas.width, h = camCanvas.height;
      const img = camCtx.createImageData(w, h);
      const d = img.data;

      const cx = w*0.5 + Math.sin(camT*0.7)*w*0.03;
      const cy = h*0.48 + Math.cos(camT*0.6)*h*0.03;
      const rx = w*0.22, ry = h*0.28;

      for(let i=0;i<d.length;i+=4){
        const px = ((i/4)%w);
        const py = Math.floor((i/4)/w);
        let n = (Math.random()*255)|0;
        n = (n*0.35 + (Math.sin((py/6)+camT*10)*42 + 80))|0;

        const dx = (px - cx)/rx;
        const dy = (py - cy)/ry;
        const inside = (dx*dx + dy*dy) < 1.0;

        let g = n;
        let r = n*0.35;
        let b = n*0.55;
        if(inside){
          g = g*0.75;
          r = r*0.55;
          b = b*0.65;
        }

        d[i]   = Math.max(0, Math.min(255, r));
        d[i+1] = Math.max(0, Math.min(255, g));
        d[i+2] = Math.max(0, Math.min(255, b));
        d[i+3] = 255;
      }
      camCtx.putImageData(img, 0, 0);

      const t = Math.floor(camT);
      const mm = String(Math.floor(t/60)).padStart(2,"0");
      const ss = String(t%60).padStart(2,"0");
      const ct = $("camTime");
      if(ct) ct.textContent = `${mm}:${ss}`;

      if(t % 2 === 0 && Math.random()<0.12){
        gps = {
          lat: (parseFloat(gps.lat) + (Math.random()*0.0003)).toFixed(6),
          lon: (parseFloat(gps.lon) + (Math.random()*0.0003)).toFixed(6)
        };
        updateGpsHud();
      }

      camTimer = requestAnimationFrame(draw);
    };
    updateGpsHud();
    camTimer = requestAnimationFrame(draw);
  }

  // ---------- Main show ----------
  function startImmediate(){
    updateGpsHud();
    addLine("BOOT: kernel stream attached", "dim");
    addLine("NET: wlan0 route verified", "dim");
    addLine("AUTH: token accepted", "dim");
    addLine("TRACE: passive telemetry started", "dim");

    runBars();
    setTimeout(()=>popupStorm(6, 160), 650);
    setTimeout(()=>popupStorm(8, 120), 1800);

    const steps = [
      { t: 450,  msg: "Initializing handshake‚Ä¶", cls:"dim" },
      { t: 900,  msg: "Negotiating secure tunnel‚Ä¶", cls:"dim" },
      { t: 1350, msg: "Bypassing lockscreen policy‚Ä¶", cls:"" },
      { t: 1850, msg: "Permission grant: üìç LOCATION", cls:"warn", fx: ()=>glitchBurst() },
      { t: 2350, msg: "Permission grant: üé§ MICROPHONE", cls:"warn", fx: ()=>flash(2) },
      { t: 2850, msg: "Permission grant: üì∑ CAMERA", cls:"warn", fx: ()=>flash(2) },
      { t: 3350, msg: "Scraping contacts‚Ä¶", cls:"" },
      { t: 3850, msg: "Mirroring notifications‚Ä¶", cls:"" },
      { t: 4350, msg: "Indexing media library‚Ä¶", cls:"" },
      { t: 5050, msg: "‚ö† DATA EXFILTRATION IN PROGRESS", cls:"warn", fx: ()=>{ redEl.style.opacity="1"; setTimeout(()=>redEl.style.opacity="0",900);} },
      { t: 5850, msg: "Finalizing‚Ä¶", cls:"dim" },
      { t: 6900, msg: "REMOTE SESSION: ACTIVE", cls:"warn", fx: ()=>{ $("threat").textContent="THREAT: CONFIRMED"; glitchBurst(); } },
    ];
    steps.forEach(s=>setTimeout(()=>{
      addLine(s.msg, s.cls);
      if(s.fx) try{s.fx();}catch(e){}
      if(audioCtx && Math.random()<0.25) beep(700+Math.random()*700, 0.05, "square", 0.09);
    }, s.t));

    setTimeout(()=>{
      $("footerWarn").textContent = "REMOTE OPERATOR CONNECTED";
      let count=0;
      const spam = setInterval(()=>{
        count++;
        const pool = [
          ["PING: keepalive", "dim"],
          ["STREAM: mic buffer opened", ""],
          [`GPS: ${gps.lat}, ${gps.lon}`, "cyan"],
          ["CAM: frame captured", ""],
          ["SYNC: messages indexed", ""],
          ["‚ö† POLICY VIOLATION DETECTED", "warn"],
          ["‚ö† INPUT CAPTURED", "warn"]
        ];
        const pick = pool[Math.floor(Math.random()*pool.length)];
        addLine(pick[0], pick[1]);
        if(Math.random()<0.10) flash(1);
        if(Math.random()<0.08) glitchBurst();
        if(audioCtx && Math.random()<0.22) beep(900 + Math.random()*700, 0.05, "square", 0.09);
        if(count>30) clearInterval(spam);
      }, 260);
    }, 7600);

    // Epic finish -> file/showcase -> lock -> rickroll
    setTimeout(()=>epicFinish(), 9800);
  }

  function epicFinish(){
    $("threat").textContent = "THREAT: CRITICAL";
    addLine("‚ö† SYSTEM OVERRIDE: ENABLED", "warn");
    addLine("‚ö† LOCKOUT: DISABLED", "warn");

    popupStorm(14, 90);

    let bursts = 0;
    const crescendo = setInterval(()=>{
      bursts++;
      glitchBurst();
      flash(2);
      if(audioCtx) beep(300 + Math.random()*1400, 0.06, "square", 0.12);
      if(audioCtx && Math.random()<0.35) startSiren(900);
      if(bursts >= 6) clearInterval(crescendo);
    }, 240);

    setTimeout(()=>{
      epic.style.opacity="1";
      epic.setAttribute("aria-hidden","false");
      redEl.style.opacity="1";
      flash(4);
      vibrate([160,80,160,80,240,120,240]);
      if(audioCtx){
        beep(180,0.18,"sawtooth",0.16);
        beep(880,0.10,"square",0.14);
        beep(1320,0.08,"square",0.14);
        startSiren(1700);
      }
      setTimeout(()=>redEl.style.opacity="0", 1300);

      addFeed("EXFILTRATION: 100% (INITIAL)", true);
      addFeed("NEXT: FILES / MEDIA / BACKUPS", false);

      startFakeCam();

      // Make files absolutely obvious:
      setTimeout(()=>fileChaosSequence(), 1800);
    }, 1600);
  }

  // ---------- Phase 2: Files / Upload / Delete (kept PG-13 wording) ----------
  function fileChaosSequence(){
    addLine("POST-BREACH: enumerating filesystem‚Ä¶", "dim");
    addFeed("ENUMERATING FILESYSTEM‚Ä¶", false);
    $("footerWarn").textContent = "FILE INDEX: IN PROGRESS";

    const files = [
      "DCIM/Camera/IMG_4921.jpg",
      "DCIM/Camera/VID_1042.mp4",
      "Pictures/Screenshots/IMG_7721.png",
      "WhatsApp Images/IMG-20240214.jpg",
      "Downloads/receipt.pdf",
      "Downloads/notes.txt",
      "Telegram Images/IMG_0198.jpg",
      "Gallery/Favorites/IMG_0007.jpg",
      "Documents/Passwords.txt",
      "Hidden/.vault/media_001.jpg",
      "Hidden/.vault/media_002.jpg",
      "Movies/Clips/clip_03.mp4"
    ];

    // Add a couple popups that reference the same phase (so it‚Äôs impossible to miss)
    spawnPopup(`File system scan started.<br><span class="bad">Media flagged</span>.`);
    setTimeout(()=>spawnPopup(`Archive builder online.<br><span class="bad">Preparing upload</span>.`), 800);

    let i = 0;
    const scan = setInterval(()=>{
      if(i >= files.length){
        clearInterval(scan);
        addLine("Index complete: 12 items flagged as SENSITIVE", "warn");
        addLine(`GPS lock acquired: ${gps.lat}, ${gps.lon}`, "cyan");
        addFeed("INDEX COMPLETE: 12 ITEMS FLAGGED", true);
        addFeed(`GPS LOCK: ${gps.lat}, ${gps.lon}`, false);
        setTimeout(()=>darkWebPhase(), 850);
        return;
      }
      addLine("üìÅ Scanning: " + files[i], "");
      addFeed("SCAN: " + files[i], false);
      if(Math.random()<0.25) flash(1);
      if(audioCtx && Math.random()<0.18) beep(650+Math.random()*500, 0.05, "square", 0.08);
      i++;
    }, 420);
  }

  function darkWebPhase(){
    addLine("Routing exfiltration channel via TOR‚Ä¶", "warn");
    addLine("üì° Exit node handshake: OK", "dim");
    addLine("üß¨ Packaging media archive: media_dump.tar", "dim");
    addLine("‚ö† Upload destination: dark-web mirror", "warn");

    addFeed("TOR ROUTE: ONLINE", false);
    addFeed("DESTINATION: DARK-WEB MIRROR", true);

    $("footerWarn").textContent = "DARK WEB MIRROR: CONNECTED";
    spawnPopup(`Destination set: <span class="bad">dark-web mirror</span>.<br>Channel: TOR/HTTPS`);

    if(audioCtx) startSiren(1200);
    flash(2);
    vibrate([80,60,80]);

    setTimeout(()=>uploadPhase(), 900);
  }

  function uploadPhase(){
    addLine("‚¨Ü Uploading discovered media‚Ä¶", "warn");
    addFeed("UPLOAD STARTED‚Ä¶", true);

    $("threat").textContent = "THREAT: EXFILTRATION";
    $("footerWarn").textContent = "MEDIA EXFILTRATION IN PROGRESS";

    let percent = 0;
    const up = setInterval(()=>{
      percent += Math.floor(Math.random()*14)+7;
      if(percent >= 100){
        percent = 100;
        addLine("Upload progress: 100% (mirror synced)", "warn");
        addFeed("UPLOAD: 100% (MIRROR SYNCED)", true);
        spawnPopup(`Upload complete.<br><span class="bad">Mirror synced</span>.`);
        clearInterval(up);
        setTimeout(()=>deletePhase(), 1000);
        return;
      }
      addLine("Upload progress: " + percent + "%", percent > 70 ? "warn" : "");
      addFeed("UPLOAD: " + percent + "%", percent > 70);
      if(audioCtx) beep(600+Math.random()*400, 0.05, "square", 0.10);
      if(Math.random()<0.16) flash(1);
    }, 420);
  }

  function deletePhase(){
    addLine("üóë Removing local copies‚Ä¶", "warn");
    addFeed("LOCAL PURGE INITIATED", true);

    $("threat").textContent = "THREAT: DATA LOSS";
    $("footerWarn").textContent = "LOCAL DATA: PURGE";

    spawnPopup(`Local purge requested.<br><span class="bad">Recovery disabled</span>.`);

    const msgs = [
      "Deleting DCIM/Camera/IMG_4921.jpg‚Ä¶",
      "Deleting Hidden/.vault/media_001.jpg‚Ä¶",
      "Deleting Hidden/.vault/media_002.jpg‚Ä¶",
      "Clearing Recent Items‚Ä¶",
      "Wiping thumbnails cache‚Ä¶",
      "Emptying trash‚Ä¶",
      "Overwriting free space‚Ä¶"
    ];

    let i = 0;
    const del = setInterval(()=>{
      if(i >= msgs.length){
        clearInterval(del);
        addLine("Purge complete. Recovery: DISABLED", "warn");
        addFeed("PURGE COMPLETE ‚Äî RECOVERY: DISABLED", true);
        setTimeout(()=>lockScreenPhase(), 1500);
        return;
      }
      addLine(msgs[i], "warn");
      addFeed(msgs[i], true);
      glitchBurst();
      if(audioCtx && Math.random()<0.55) beep(980+Math.random()*700, 0.05, "square", 0.11);
      i++;
    }, 760);
  }

  // ---------- Lock, then Rick Roll ----------
  function lockScreenPhase(){
    addLine("‚ö† REMOTE ENFORCEMENT: ENABLED", "warn");
    addLine("Applying device lock policy‚Ä¶", "dim");
    addFeed("LOCKDOWN POLICY APPLIED", true);

    $("footerWarn").textContent = "ENFORCING LOCKDOWN";

    setTimeout(()=>{
      lock.style.display = "block";
      lock.setAttribute("aria-hidden","false");
      flash(3);
      redEl.style.opacity="1";
      setTimeout(()=>redEl.style.opacity="0", 900);
      vibrate([200,100,200,100,300]);
      if(audioCtx){
        startSiren(1800);
        beep(200,0.2,"sawtooth",0.2);
      }

      // PIN always fails (harmless)
      const pin = $("pinInput");
      const err = $("pinErr");
      const fail = ()=>{
        if(err) err.style.opacity = "1";
        if(audioCtx) beep(1400,0.06,"square",0.12);
        setTimeout(()=>{ if(err) err.style.opacity = "0"; }, 700);
        if(pin) pin.value = "";
      };
      if(pin){
        pin.addEventListener("keydown", (e)=>{ if(e.key === "Enter") fail(); });
        pin.addEventListener("input", ()=>{ if(pin.value.length >= 4) fail(); });
      }

      // After a beat, drop the final payload (Rick Roll)
      setTimeout(()=>finalPayloadRickRoll(), 5200);
    }, 2400);
  }

  function finalPayloadRickRoll(){
    // Hide everything else
    lock.style.display = "none";
    epic.style.opacity = "0";
    $("wrap").style.display = "none";
    popLayer.style.display = "none";
    redEl.style.opacity = "0";
    flash(2);

    final.style.display = "block";
    final.setAttribute("aria-hidden","false");

    // Try to embed YouTube. Autoplay often blocked, so button will start it.
    const playBtn = $("playBtn");
    const slot = $("vidSlot");

    const videoId = "dQw4w9WgXcQ";
    function mountVideo(autoplay){
      slot.innerHTML = `
        <iframe
          src="https://www.youtube.com/embed/${videoId}?autoplay=${autoplay ? 1 : 0}&playsinline=1&rel=0&modestbranding=1"
          title="Incident Report"
          frameborder="0"
          allow="autoplay; encrypted-media; picture-in-picture"
          allowfullscreen>
        </iframe>
      `;
    }

    // Pre-mount without autoplay (works reliably)
    mountVideo(false);

    playBtn.addEventListener("click", ()=>{
      // Re-mount with autoplay (user gesture = allowed)
      mountVideo(true);
      playBtn.style.display = "none";
      if(audioCtx){ beep(880,0.08,"square",0.12); }
      vibrate([80,40,80]);
    });

    // Helpful: if iframe blocked, open YouTube directly
    setTimeout(()=>{
      if(playBtn.style.display !== "none"){
        // subtle nudge
        playBtn.textContent = "PLAY REPORT (TAP)";
      }
    }, 1200);
  }

  // ---------- Fullscreen / sound arming ----------
  let armed = false;
  async function armOnFirstTap(){
    if(armed) return;
    armed = true;

    document.body.classList.add("fullscreen-ish");

    const hint = $("tapHint");
    if(hint){
      hint.style.opacity = "0";
      setTimeout(()=>{ try{hint.remove();}catch(e){} }, 220);
    }

    // Fullscreen best-effort (Chrome may still show bars)
    try{
      const el = document.documentElement;
      if(el.requestFullscreen) await el.requestFullscreen({ navigationUI: "hide" });
      else if(el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
    }catch(e){}

    // Unlock audio
    initAudio();
    try{ await audioCtx.resume(); }catch(e){}

    flash(3);
    redEl.style.opacity="1";
    setTimeout(()=>redEl.style.opacity="0", 650);
    vibrate([120,60,120,60,220]);
    beep(980,0.08,"square",0.14);

    addLine("‚ö† USER GESTURE CAPTURED", "warn");
    addLine("Audio channel: OPEN", "dim");
    addLine("Fullscreen mode: REQUESTED", "dim");
    addLine("Tip: Add to Home Screen for true no-bars mode", "dim");
  }

  document.addEventListener("pointerdown", ()=>armOnFirstTap(), {passive:true});
  document.addEventListener("keydown", ()=>armOnFirstTap(), {passive:true});

  // ---------- Random mini-glitches on taps ----------
  document.addEventListener("click", ()=>{
    if(Math.random()<0.18){
      glitchBurst();
      addLine("‚ö† INPUT CAPTURED", "warn");
      if(audioCtx) beep(1100,0.05,"square",0.10);
    }
  }, {passive:true});

  // ---------- Start NOW ----------
  startImmediate();

  // ---------- Optional: true fullscreen tip ----------
  // Best solution (real-world): add this page to Home Screen.
  // Android: Chrome ‚ãÆ > Add to Home screen. Then opening it is near full immersive.
</script>
</body>
</html>
