<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#0f0f10" />
<title>Whack Rush</title>
<meta name="description" content="Whack Rush â€” 15 second mini game. Beat my score!" />

<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:
    radial-gradient(900px 600px at 60% -10%, rgba(58,130,247,.16), transparent 55%),
    radial-gradient(900px 650px at 10% 110%, rgba(124,58,237,.12), transparent 55%),
    #0f0f10;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:14px;
  overflow:hidden;
}

.card{
  width:min(520px, 95vw);
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  padding:16px;
  box-shadow:0 18px 70px rgba(0,0,0,.55);
}

.top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.title{font-weight:900;font-size:20px;margin:0}
.sub{color:rgba(255,255,255,.72);font-size:13px;margin:6px 0 0;line-height:1.35}
.pill{
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  padding:8px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
  white-space:nowrap;
}

.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin:12px 0 10px;
}
.stat{
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.25);
  border-radius:16px;
  padding:10px;
  text-align:center;
}
.stat .k{font-size:12px;color:rgba(255,255,255,.65);margin-bottom:4px}
.stat .v{font-size:22px;font-weight:950}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin:12px 0;
}
.hole{
  background:rgba(0,0,0,.40);
  border:1px solid rgba(255,255,255,.10);
  border-radius:18px;
  aspect-ratio:1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:34px;
  user-select:none;
  position:relative;
  overflow:hidden;
}
.hole:active{ transform: scale(.99); }

.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{
  flex:1;
  min-width: 150px;
  border:none;
  border-radius:14px;
  padding:12px 12px;
  font-weight:900;
  cursor:pointer;
}
.primary{background:linear-gradient(135deg,#3a82f7,#7c3aed);color:#fff}
.ghost{background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.10)}
.btn:disabled{opacity:.55;cursor:not-allowed}

.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom: calc(14px + env(safe-area-inset-bottom));
  background: rgba(0,0,0,.75);
  border: 1px solid rgba(255,255,255,.12);
  color:#fff;
  padding:10px 12px;
  border-radius: 12px;
  font-size:13px;
  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease;
  max-width: min(520px, 92vw);
  text-align:center;
  z-index:50;
}
.toast.show{opacity:1}
</style>
</head>

<body>
  <div class="card">
    <div class="top">
      <div>
        <h1 class="title">Whack Rush</h1>
        <p class="sub">Tap the mole as it pops up. You have <b>15 seconds</b>. Beat your best.</p>
      </div>
      <div class="pill" id="statusPill">Ready</div>
    </div>

    <div class="stats">
      <div class="stat"><div class="k">Time</div><div class="v" id="timeV">15.0</div></div>
      <div class="stat"><div class="k">Score</div><div class="v" id="scoreV">0</div></div>
      <div class="stat"><div class="k">Best</div><div class="v" id="bestV">0</div></div>
    </div>

    <div class="grid" id="grid" aria-label="Whack grid"></div>

    <div class="row">
      <button class="btn primary" id="startBtn">Start</button>
      <button class="btn ghost" id="shareBtn" disabled>Share score</button>
    </div>

    <div class="row">
      <button class="btn ghost" id="resetBestBtn">Reset best</button>
      <button class="btn ghost" id="menuBtn">Back to menu</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  // âœ… Main menu index (ads live here)
  const MAIN_PAGE_URL = "https://xstajayx.github.io/message-media-space/";

  // âœ… Game identification used in the share URL
  const GAME_KEY = "whack-rush";

  const ROUND_SECONDS = 15;

  const grid = document.getElementById("grid");
  const timeV = document.getElementById("timeV");
  const scoreV = document.getElementById("scoreV");
  const bestV  = document.getElementById("bestV");
  const statusPill = document.getElementById("statusPill");

  const startBtn = document.getElementById("startBtn");
  const shareBtn = document.getElementById("shareBtn");
  const resetBestBtn = document.getElementById("resetBestBtn");
  const menuBtn = document.getElementById("menuBtn");

  const toast = document.getElementById("toast");

  // Build grid once
  const HOLES = 9;
  for(let i=0;i<HOLES;i++){
    const h = document.createElement("div");
    h.className = "hole";
    h.dataset.idx = String(i);
    grid.appendChild(h);
  }

  let best = Number(localStorage.getItem("best_" + GAME_KEY) || 0);
  bestV.textContent = best;

  let running = false;
  let finished = false; // âœ… stops taps restarting the game after 0
  let score = 0;
  let endAt = 0;
  let raf = 0;
  let moleTimer = 0;
  let activeIdx = -1;

  function showToast(msg, ms=1600){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"), ms);
  }

  function clearMole(){
    if(activeIdx < 0) return;
    const hole = grid.children[activeIdx];
    hole.textContent = "";
    hole.onclick = null;
    activeIdx = -1;
  }

  function showMole(){
    clearMole();
    activeIdx = Math.floor(Math.random() * HOLES);
    const hole = grid.children[activeIdx];
    hole.textContent = "ðŸ¹";
    hole.onclick = () => {
      if(!running) return;
      score++;
      scoreV.textContent = String(score);
      // Remove instantly so they can't multi-tap same mole
      hole.textContent = "";
      hole.onclick = null;
      activeIdx = -1;
    };
  }

  function setReady(){
    running = false;
    finished = false;
    score = 0;
    scoreV.textContent = "0";
    timeV.textContent = ROUND_SECONDS.toFixed(1);
    statusPill.textContent = "Ready";
    shareBtn.disabled = true;
    clearTimeout(moleTimer);
    cancelAnimationFrame(raf);
    clearMole();
  }

  function tick(){
    const leftMs = Math.max(0, endAt - performance.now());
    timeV.textContent = (leftMs/1000).toFixed(1);

    if(leftMs <= 0){
      timeV.textContent = "0.0";
      finish();
      return;
    }
    raf = requestAnimationFrame(tick);
  }

  function moleLoop(){
    if(!running) return;
    showMole();

    // Slight speed increase as score rises (but fair)
    const interval = Math.max(240, 650 - Math.min(score * 12, 420));
    moleTimer = setTimeout(moleLoop, interval);
  }

  function start(){
    if(running) return;

    running = true;
    finished = false;
    score = 0;
    scoreV.textContent = "0";
    endAt = performance.now() + ROUND_SECONDS * 1000;
    statusPill.textContent = "GO!";
    shareBtn.disabled = true;

    tick();
    moleLoop();
  }

  function finish(){
    running = false;
    finished = true; // âœ… lock
    statusPill.textContent = "Done";
    shareBtn.disabled = false;

    cancelAnimationFrame(raf);
    clearTimeout(moleTimer);
    clearMole();

    if(score > best){
      best = score;
      localStorage.setItem("best_" + GAME_KEY, String(best));
      bestV.textContent = String(best);
      showToast("New best! ðŸ”¥ " + best);
    }else{
      showToast("Score: " + score);
    }
  }

  function buildShareUrl(s){
    const u = new URL(MAIN_PAGE_URL);
    u.searchParams.set("game", GAME_KEY);
    u.searchParams.set("score", String(s));
    return u.toString();
  }

  async function shareScore(){
    const url = buildShareUrl(score);
    const text = `Try this! My score is ${score} ðŸ˜„`;

    const data = { title: "Whack Rush", text, url };

    if(navigator.share){
      try{ await navigator.share(data); return; }catch(e){}
    }

    try{
      await navigator.clipboard.writeText(`${text} ${url}`);
      showToast("Copied share text + link âœ…");
    }catch(e){
      prompt("Copy this:", `${text} ${url}`);
    }
  }

  // Buttons
  startBtn.addEventListener("click", start);
  shareBtn.addEventListener("click", shareScore);

  resetBestBtn.addEventListener("click", ()=>{
    localStorage.removeItem("best_" + GAME_KEY);
    best = 0;
    bestV.textContent = "0";
    showToast("Best reset");
  });

  menuBtn.addEventListener("click", ()=>{
    location.href = MAIN_PAGE_URL;
  });

  // Prevent accidental play after finished: taps do nothing (no trick restart)
  grid.addEventListener("click", ()=>{
    if(finished && !running) return;
  });

  // init
  setReady();
</script>
</body>
</html>
